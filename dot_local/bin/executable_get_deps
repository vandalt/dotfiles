#!/usr/bin/env python
import argparse
import sys
import tomllib
from pathlib import Path

parser = argparse.ArgumentParser(
    description="Extract dependencies from pyproject.toml and write to requirements.txt"
)
parser.add_argument(
    "pyproject",
    nargs="?",
    default="pyproject.toml",
    help="Path to pyproject.toml file (default: pyproject.toml)",
)
parser.add_argument(
    "--output",
    "-o",
    default="requirements.txt",
    help="Output file path (default: requirements.txt)",
)
parser.add_argument(
    "--force",
    "-f",
    action="store_true",
    help="Force overwrite if output file already exists",
)
args = parser.parse_args()

pyproject_path = Path(args.pyproject)
if not pyproject_path.exists():
    print(f"Error: {pyproject_path} not found", file=sys.stderr)
    sys.exit(1)

with open(pyproject_path, "rb") as f:
    data = tomllib.load(f)

deps = data.get("project", {}).get("dependencies", [])

output_path = Path(args.output)
if output_path.exists() and not args.force:
    print(f"Error: {output_path} already exists. Use --force to overwrite.", file=sys.stderr)
    sys.exit(1)

with open(output_path, "w") as f:
    f.write("\n".join(deps))
